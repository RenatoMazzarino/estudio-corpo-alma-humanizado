<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Atendimento ‚Äî UI (Etapas Horizontais) v2</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            studio: {
              green: "#6A806C",
              dark: "#4e5f50",
              light: "#F3F6F4",
              accent: "#D4A373",
            },
            paper: "#FAF9F6",
            text: { main: "#2C3333", muted: "#868E96" },
            dom: "#A855F7",
            danger: "#DC2626",
            ok: "#16A34A",
            graychip: "#E9ECEF"
          },
          fontFamily: {
            serif: ['"Playfair Display"', "serif"],
            sans: ['"Lato"', "sans-serif"],
          },
          boxShadow: {
            soft: "0 4px 20px -2px rgba(106, 128, 108, 0.15)",
            floaty: "0 18px 45px rgba(0,0,0,0.20)"
          },
        },
      },
    };
  </script>

  <style>
    body { background:#222; height:100vh; display:flex; justify-content:center; font-family:"Lato", sans-serif; }
    #mobile-frame { width:100%; max-width:414px; height:100vh; background:#FAF9F6; position:relative; overflow:hidden; display:flex; flex-direction:column; }
    .no-scrollbar::-webkit-scrollbar { display:none; }
    .no-scrollbar { scrollbar-width:none; -ms-overflow-style:none; }

    /* Header: compacto sempre vis√≠vel + painel expandido colaps√°vel */
    #header { background:#fff; border-bottom-left-radius: 2.5rem; border-bottom-right-radius: 2.5rem; box-shadow: 0 4px 20px -2px rgba(106, 128, 108, 0.15); position:relative; z-index:50; }
    #header .flag { position:absolute; inset-inline:0; top:0; height:112px; background: linear-gradient(to bottom, rgba(243,246,244,1), rgba(255,255,255,1)); }

    #expanded-panel {
      overflow:hidden;
      max-height: 420px;
      opacity: 1;
      transform: translateY(0);
      transition: max-height .25s ease, opacity .18s ease, transform .18s ease;
    }

    #header.compact #expanded-panel {
      max-height: 0px;
      opacity: 0;
      transform: translateY(-6px);
    }

    /* Pager horizontal */
    .pager {
      display:flex;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      scroll-behavior:smooth;
      overscroll-behavior-x: contain;
      -webkit-overflow-scrolling: touch;
    }
    .stage {
      min-width:100%;
      scroll-snap-align:start;
      padding: 14px 18px 100px;
    }

    /* Floating bubble */
    #timer-bubble {
      position:absolute;
      right:18px; top:140px;
      width:112px; height:112px;
      border-radius:999px;
      z-index:80;
      box-shadow: 0 18px 45px rgba(0,0,0,0.25);
      display:none;
      user-select:none;
      touch-action:none;
      cursor:grab;
      background: rgba(255,255,255,0.84);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(106,128,108,0.22);
    }
    #timer-bubble:active { cursor:grabbing; }

    .ring-pulse { animation: ringPulse 1.9s ease-in-out infinite; transform-origin:center; }
    @keyframes ringPulse { 0%,100% { opacity:.82; } 50% { opacity:.38; } }

    /* Bottom stage bar (menor) */
    #stage-bar {
      position:absolute;
      left:0; right:0; bottom:0;
      width:100%;
      max-width:414px;
      padding:10px 12px 12px;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(0,0,0,0.06);
      z-index:60;
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      box-shadow: 0 -16px 36px rgba(0,0,0,0.06);
    }

    /* Etapas status row (pequeno, sem ocupar espa√ßo demais) */
    .stage-dots { display:flex; gap:8px; align-items:center; justify-content:center; }
    .dot {
      display:flex; align-items:center; gap:6px;
      padding:6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.06);
      font-size: 10px;
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      background: #fff;
      color: #868E96;
    }
    .dot .b { width:8px; height:8px; border-radius:999px; background:#E9ECEF; }
    .dot.running { color:#4e5f50; border-color: rgba(106,128,108,0.20); }
    .dot.running .b { background:#6A806C; }
    .dot.done { color:#166534; border-color: rgba(22,163,74,0.20); }
    .dot.done .b { background:#16A34A; }

    /* Toast */
    #toast {
      position:absolute;
      left:12px; right:12px;
      bottom:88px;
      z-index:120;
      display:none;
    }
  </style>
</head>

<body>
  <div id="mobile-frame">

    <!-- Floating Bubble -->
    <div id="timer-bubble" onmousedown="dragStart(event)" ontouchstart="dragStart(event)">
      <div class="w-full h-full relative flex items-center justify-center">
        <svg class="absolute inset-0" viewBox="0 0 120 120">
          <circle cx="60" cy="60" r="46" stroke="rgba(106,128,108,0.16)" stroke-width="8" fill="none"></circle>
          <circle id="bubble-ring" cx="60" cy="60" r="46"
            stroke="#6A806C" stroke-width="8" fill="none"
            stroke-linecap="round"
            transform="rotate(-90 60 60)"
          ></circle>
        </svg>

        <div class="flex flex-col items-center gap-1">
          <div class="flex items-center gap-2">
            <button id="bubble-playpause" onclick="toggleTimer(event)"
              class="w-9 h-9 rounded-2xl bg-studio-light text-studio-green flex items-center justify-center border border-studio-green/10 hover:bg-white transition">
            </button>
            <span id="bubble-time" class="text-lg font-black text-gray-800 tabular-nums">00:00</span>
          </div>
          <button onclick="restoreFromBubble()" class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest hover:text-studio-green transition">
            Voltar
          </button>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header id="header">
      <div class="flag"></div>

      <div class="relative px-5 pt-8 pb-4">
        <!-- Top actions -->
        <div class="flex items-center justify-between">
          <button class="w-10 h-10 rounded-full bg-white/80 backdrop-blur text-gray-600 flex items-center justify-center shadow-sm hover:bg-white transition" title="Voltar">
            <i data-lucide="chevron-left" class="w-5 h-5"></i>
          </button>

          <button onclick="minimizeToBubble()"
            class="w-10 h-10 rounded-full bg-white/80 backdrop-blur text-gray-600 flex items-center justify-center shadow-sm hover:bg-white transition"
            title="Minimizar para bolha flutuante">
            <i data-lucide="minimize-2" class="w-5 h-5"></i>
          </button>
        </div>

        <!-- Compact row (sempre vis√≠vel) -->
        <div class="mt-5 flex items-center justify-between">
          <button class="flex items-center gap-3 min-w-0" title="Abrir cliente (futuro)">
            <div class="w-10 h-10 rounded-full bg-studio-light text-studio-green flex items-center justify-center font-serif font-bold">AC</div>
            <div class="min-w-0 leading-tight text-left">
              <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Atendimento</p>
              <p class="text-sm font-bold text-gray-800 truncate">Ana Clara</p>
            </div>
          </button>

          <div class="flex items-center gap-2 bg-paper border border-gray-100 rounded-2xl px-3 py-2">
            <span id="header-time-compact" class="text-sm font-black text-gray-800 tabular-nums">00:00</span>
            <button id="header-playpause-compact" onclick="toggleTimer(event)"
              class="w-9 h-9 rounded-2xl bg-studio-light text-studio-green flex items-center justify-center border border-studio-green/10 hover:bg-white transition">
            </button>
          </div>
        </div>

        <!-- Expanded panel (colapsa, mas n√£o deixa o header em branco) -->
        <div id="expanded-panel" class="mt-5">
          <div class="flex items-start gap-4">
            <div class="w-14 h-14 rounded-full bg-studio-green text-white flex items-center justify-center font-serif font-bold text-xl shadow-md">AC</div>

            <div class="flex-1 min-w-0">
              <h1 class="text-2xl font-serif font-bold text-gray-800 leading-tight">Ana Clara Souza</h1>
              <p class="text-xs font-extrabold text-gray-400 uppercase tracking-widest mt-1">Massagem Relaxante ‚Ä¢ 60 min</p>

              <div class="flex flex-wrap items-center gap-2 mt-3">
                <span class="px-2.5 py-1 rounded-xl bg-paper border border-gray-100 text-[11px] font-bold text-gray-700">
                  <i data-lucide="calendar" class="inline w-4 h-4 -mt-0.5 mr-1 text-studio-green"></i>
                  Hoje ‚Ä¢ 10:45
                </span>
                <span class="px-2.5 py-1 rounded-xl bg-purple-50 border border-purple-100 text-[11px] font-bold text-dom">
                  <i data-lucide="home" class="inline w-4 h-4 -mt-0.5 mr-1"></i>
                  Domic√≠lio
                </span>
              </div>
            </div>

            <!-- Quick actions (icon-only) -->
            <div class="flex flex-col gap-2">
              <button class="w-11 h-11 rounded-2xl bg-white border border-gray-100 shadow-sm flex items-center justify-center hover:bg-gray-50 transition" title="WhatsApp">
                <svg width="22" height="22" viewBox="0 0 32 32" fill="none" aria-hidden="true">
                  <path d="M16 3C9.1 3 3.5 8.6 3.5 15.5c0 2.7.9 5.2 2.3 7.2L5 29l6.5-1.7c2 .9 4.2 1.4 6.5 1.4 6.9 0 12.5-5.6 12.5-12.5S22.9 3 16 3z" fill="#25D366" opacity="0.95"/>
                  <path d="M13.4 10.2c-.3-.7-.6-.7-.9-.7h-.8c-.3 0-.7.1-1 .4-.3.3-1.3 1.2-1.3 3s1.3 3.5 1.5 3.8c.2.3 2.5 4 6.2 5.4 3 .9 3.7.7 4.3.6.6-.1 1.9-.8 2.1-1.6.3-.8.3-1.4.2-1.6-.1-.2-.3-.3-.7-.5l-2.1-1c-.2-.1-.5-.2-.7.2-.2.4-.8 1.6-1 1.9-.2.3-.4.4-.8.2-.4-.2-1.6-.6-3.1-1.9-1.1-1-1.9-2.2-2.1-2.6-.2-.4 0-.6.2-.8l.6-.7c.2-.2.2-.4.3-.6.1-.2 0-.4-.1-.6l-.8-2z" fill="#fff"/>
                </svg>
              </button>

              <button class="w-11 h-11 rounded-2xl bg-white border border-gray-100 shadow-sm flex items-center justify-center hover:bg-gray-50 transition" title="Mapa">
                <i data-lucide="map-pin" class="w-5 h-5 text-studio-green"></i>
              </button>

              <button class="w-11 h-11 rounded-2xl bg-black shadow-sm flex items-center justify-center hover:scale-[1.02] transition" title="Spotify">
                <svg class="w-6 h-6 text-[#1DB954]" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141 4.2-1.32 9.6-0.66 13.38 1.68.42.18.6.72.36 1.14zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Timer card -->
          <div class="mt-5 bg-paper border border-gray-100 rounded-3xl p-3 flex items-center justify-between">
            <div>
              <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Tempo do atendimento</p>
              <p id="header-time" class="text-2xl font-black text-gray-800 tabular-nums leading-tight">00:00</p>
            </div>
            <button id="header-playpause" onclick="toggleTimer(event)"
              class="h-12 px-4 rounded-2xl bg-studio-green text-white font-extrabold shadow-lg shadow-green-200 active:scale-95 transition flex items-center gap-2">
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main scroll -->
    <main id="scroll" class="flex-1 overflow-y-auto no-scrollbar bg-paper">
      <div id="pager" class="pager no-scrollbar">

        <!-- PRE -->
        <section class="stage" data-stage="pre">
          <div class="space-y-5">

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <h2 class="text-lg font-serif font-bold text-gray-800">Pr√©-atendimento</h2>
                  <p class="text-xs text-gray-400 mt-1">Log√≠stica, confirma√ß√£o e mensageria.</p>
                </div>
                <span id="badge-pre" class="px-3 py-1 rounded-2xl bg-gray-50 text-gray-500 text-[11px] font-extrabold border border-gray-100">PENDENTE</span>
              </div>

              <div class="mt-4 grid grid-cols-2 gap-3">
                <div class="bg-paper rounded-2xl p-3 border border-gray-100">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Data</p>
                  <p class="text-sm font-bold text-gray-800">Hoje</p>
                </div>
                <div class="bg-paper rounded-2xl p-3 border border-gray-100">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Hor√°rio</p>
                  <p class="text-sm font-bold text-gray-800">10:45</p>
                </div>
                <div class="bg-paper rounded-2xl p-3 border border-gray-100">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Local</p>
                  <p class="text-sm font-bold text-dom">Domic√≠lio</p>
                </div>
                <div class="bg-paper rounded-2xl p-3 border border-gray-100">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Endere√ßo</p>
                  <p class="text-sm font-bold text-gray-800 truncate">Rua das Ac√°cias, 120</p>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <h3 class="text-xs font-extrabold text-gray-400 uppercase tracking-widest mb-4">Mensageria (base para WhatsApp)</h3>

              <div class="space-y-3">
                <div class="flex items-center justify-between gap-3 bg-paper border border-gray-100 rounded-2xl p-4">
                  <div class="min-w-0">
                    <p class="text-sm font-bold text-gray-800">Mensagem do agendamento</p>
                    <p id="msg-booking" class="text-[11px] font-bold text-gray-400">Status: n√£o enviada</p>
                  </div>
                  <button onclick="markSent('msg-booking')" class="px-3 py-2 rounded-2xl bg-studio-light text-studio-green font-extrabold text-xs border border-studio-green/10 hover:bg-white transition">
                    Enviar
                  </button>
                </div>

                <div class="flex items-center justify-between gap-3 bg-paper border border-gray-100 rounded-2xl p-4">
                  <div class="min-w-0">
                    <p class="text-sm font-bold text-gray-800">Confirma√ß√£o 24h (confirmar/cancelar)</p>
                    <p id="msg-24h" class="text-[11px] font-bold text-gray-400">Status: n√£o enviada</p>
                  </div>
                  <button onclick="markSent('msg-24h')" class="px-3 py-2 rounded-2xl bg-studio-light text-studio-green font-extrabold text-xs border border-studio-green/10 hover:bg-white transition">
                    Enviar
                  </button>
                </div>

                <div class="flex items-center justify-between gap-3 bg-white border border-dashed border-gray-200 rounded-2xl p-4">
                  <div class="min-w-0">
                    <p class="text-sm font-bold text-gray-800">Confirma√ß√£o manual</p>
                    <p id="confirm-status" class="text-[11px] font-bold text-gray-400">Ainda n√£o confirmada</p>
                  </div>
                  <button onclick="confirmAppointment()" class="px-3 py-2 rounded-2xl bg-studio-green text-white font-extrabold text-xs shadow-sm active:scale-95 transition">
                    Marcar confirmada
                  </button>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <h3 class="text-xs font-extrabold text-gray-400 uppercase tracking-widest mb-4">Checklist</h3>
              <div class="space-y-2">
                <label class="flex items-center justify-between bg-paper border border-gray-100 rounded-2xl p-4">
                  <div class="flex items-center gap-3">
                    <input type="checkbox" class="w-5 h-5 accent-[#6A806C]" />
                    <span class="text-sm font-bold text-gray-800">Separar toalhas e √≥leo</span>
                  </div>
                  <span class="text-[10px] font-extrabold text-gray-400 uppercase">prep</span>
                </label>
                <label class="flex items-center justify-between bg-paper border border-gray-100 rounded-2xl p-4">
                  <div class="flex items-center gap-3">
                    <input type="checkbox" class="w-5 h-5 accent-[#6A806C]" />
                    <span class="text-sm font-bold text-gray-800">Confirmar endere√ßo e vaga</span>
                  </div>
                  <span class="text-[10px] font-extrabold text-gray-400 uppercase">log</span>
                </label>
              </div>

              <div class="mt-4">
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-2">Observa√ß√µes internas</p>
                <textarea class="w-full h-28 bg-paper rounded-2xl p-4 text-sm text-gray-700 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-studio-green/20 resize-none"
                  placeholder="Detalhes importantes antes da sess√£o..."></textarea>
              </div>
            </div>

          </div>
        </section>

        <!-- SESS√ÉO -->
        <section class="stage" data-stage="sessao">
          <div id="lock-sessao" class="hidden bg-white rounded-3xl p-5 shadow-soft border border-white">
            <p class="text-sm font-bold text-gray-800">Etapa bloqueada</p>
            <p class="text-xs text-gray-400 mt-1">Conclua a confirma√ß√£o no Pr√©-atendimento para liberar.</p>
          </div>

          <div id="content-sessao" class="space-y-5">
            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <h2 class="text-lg font-serif font-bold text-gray-800">Sess√£o</h2>
                  <p class="text-xs text-gray-400 mt-1">Evolu√ß√£o estruturada + hist√≥rico.</p>
                </div>
                <span id="badge-sessao" class="px-3 py-1 rounded-2xl bg-gray-50 text-gray-500 text-[11px] font-extrabold border border-gray-100">BLOQUEADA</span>
              </div>

              <div class="mt-4 bg-paper border border-gray-100 rounded-3xl p-4">
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Presets r√°pidos</p>
                <div class="flex flex-wrap gap-2 mt-2">
                  <button class="px-3 py-1.5 rounded-2xl bg-white border border-gray-100 text-xs font-extrabold text-studio-green">Relaxamento</button>
                  <button class="px-3 py-1.5 rounded-2xl bg-white border border-gray-100 text-xs font-extrabold text-studio-green">Lombar</button>
                  <button class="px-3 py-1.5 rounded-2xl bg-white border border-gray-100 text-xs font-extrabold text-studio-green">Ombros</button>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white space-y-4">
              <div>
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-2">Queixa / Objetivo</p>
                <textarea class="w-full h-24 bg-paper rounded-2xl p-4 text-sm text-gray-700 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-studio-green/20 resize-none"
                  placeholder="Ex.: tens√£o cervical, relaxamento geral..."></textarea>
              </div>
              <div>
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-2">T√©cnicas aplicadas</p>
                <textarea class="w-full h-24 bg-paper rounded-2xl p-4 text-sm text-gray-700 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-studio-green/20 resize-none"
                  placeholder="Ex.: deslizamento, amassamento, libera√ß√£o..."></textarea>
              </div>
              <div>
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-2">Resposta / Recomenda√ß√µes</p>
                <textarea class="w-full h-24 bg-paper rounded-2xl p-4 text-sm text-gray-700 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-studio-green/20 resize-none"
                  placeholder="Ex.: hidrata√ß√£o, alongamento, retorno..."></textarea>
              </div>

              <div class="flex gap-3">
                <button onclick="toast('Rascunho salvo (demo).')"
                  class="flex-1 h-12 rounded-2xl bg-paper border border-gray-200 text-gray-700 font-extrabold text-xs hover:bg-gray-50 transition">
                  Salvar rascunho
                </button>
                <button onclick="toast('Evolu√ß√£o publicada (demo).')"
                  class="flex-1 h-12 rounded-2xl bg-studio-green text-white font-extrabold text-xs shadow-lg shadow-green-200 active:scale-95 transition">
                  Publicar evolu√ß√£o
                </button>
              </div>
            </div>

            <div class="bg-white/60 rounded-3xl p-5 border border-dashed border-gray-200">
              <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Hist√≥rico</p>
              <p class="text-sm font-bold text-gray-800 mt-2">√öltima sess√£o (15/01)</p>
              <p class="text-xs text-gray-500 mt-1 italic">‚ÄúSentiu desconforto na lombar ap√≥s treino. Foco na regi√£o.‚Äù</p>
            </div>
          </div>
        </section>

        <!-- CHECKOUT -->
        <section class="stage" data-stage="checkout">
          <div id="lock-checkout" class="hidden bg-white rounded-3xl p-5 shadow-soft border border-white">
            <p class="text-sm font-bold text-gray-800">Etapa bloqueada</p>
            <p class="text-xs text-gray-400 mt-1">Conclua a Sess√£o para liberar o Checkout.</p>
          </div>

          <div id="content-checkout" class="space-y-5">
            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <h2 class="text-lg font-serif font-bold text-gray-800">Checkout</h2>
                  <p class="text-xs text-gray-400 mt-1">Itens, desconto e confirma√ß√£o de pagamento.</p>
                </div>
                <span id="badge-checkout" class="px-3 py-1 rounded-2xl bg-gray-50 text-gray-500 text-[11px] font-extrabold border border-gray-100">BLOQUEADA</span>
              </div>

              <div class="mt-4 bg-paper border border-gray-100 rounded-3xl p-4">
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-3">Itens</p>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between font-bold text-gray-800">
                    <span>Massagem Relaxante</span>
                    <span id="item-service">R$ 120,00</span>
                  </div>
                  <div class="flex justify-between font-bold text-dom">
                    <span class="flex items-center gap-1"><i data-lucide="car" class="w-4 h-4"></i> Taxa deslocamento</span>
                    <span id="item-fee">R$ 50,00</span>
                  </div>
                  <div class="h-px bg-gray-100 my-2"></div>
                  <div class="flex justify-between text-gray-500 font-bold">
                    <span>Subtotal</span>
                    <span id="subtotal">R$ 170,00</span>
                  </div>
                </div>
              </div>

              <div class="mt-4 bg-white border border-gray-100 rounded-3xl p-4">
                <div class="flex items-center justify-between">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Desconto</p>
                  <div class="flex gap-2">
                    <button id="mode-value" onclick="setDiscountMode('value')" class="px-3 py-1.5 rounded-2xl bg-studio-light text-studio-green font-extrabold text-[11px] border border-studio-green/10">R$</button>
                    <button id="mode-pct" onclick="setDiscountMode('pct')" class="px-3 py-1.5 rounded-2xl bg-paper text-gray-500 font-extrabold text-[11px] border border-gray-200">%</button>
                  </div>
                </div>

                <div class="mt-3 flex items-center gap-3">
                  <div class="flex-1 bg-paper border border-gray-100 rounded-2xl px-4 py-3">
                    <label class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Valor</label>
                    <input id="discount-input" type="number" inputmode="decimal" step="0.01" value="0"
                      class="w-full bg-transparent outline-none text-lg font-black text-gray-800 tabular-nums mt-1"
                      oninput="recalcTotal()">
                  </div>
                  <div class="bg-paper border border-gray-100 rounded-2xl px-4 py-3">
                    <label class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Aplicado</label>
                    <p id="discount-applied" class="text-lg font-black text-gray-800 tabular-nums mt-1">R$ 0,00</p>
                  </div>
                </div>

                <div class="mt-3 bg-paper border border-gray-100 rounded-2xl px-4 py-3">
                  <label class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Motivo</label>
                  <input id="discount-reason" type="text" placeholder="Ex.: fidelidade / ajuste"
                    class="w-full bg-transparent outline-none text-sm font-bold text-gray-800 mt-1">
                </div>
              </div>

              <div class="mt-4 flex items-end justify-between">
                <div>
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Total a pagar</p>
                  <p id="total" class="text-3xl font-serif font-bold text-studio-green">R$ 170,00</p>
                </div>
                <span id="pay-status" class="px-3 py-1 rounded-2xl bg-gray-50 text-gray-500 text-[11px] font-extrabold border border-gray-100">ABERTO</span>
              </div>
            </div>

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <h3 class="text-xs font-extrabold text-gray-400 uppercase tracking-widest mb-4">Pagamento</h3>

              <div class="grid grid-cols-2 gap-3">
                <button onclick="selectPay('pix')" id="pay-pix"
                  class="py-3 px-4 rounded-2xl border-2 border-studio-green bg-studio-light text-studio-green font-extrabold text-xs flex items-center justify-center gap-2">
                  <i data-lucide="qr-code" class="w-4 h-4"></i> Pix
                </button>
                <button onclick="selectPay('card')" id="pay-card"
                  class="py-3 px-4 rounded-2xl border border-gray-200 text-gray-500 font-extrabold text-xs flex items-center justify-center gap-2 hover:bg-gray-50 transition">
                  <i data-lucide="credit-card" class="w-4 h-4"></i> Cart√£o
                </button>
                <button onclick="selectPay('cash')" id="pay-cash"
                  class="py-3 px-4 rounded-2xl border border-gray-200 text-gray-500 font-extrabold text-xs flex items-center justify-center gap-2 hover:bg-gray-50 transition">
                  <i data-lucide="banknote" class="w-4 h-4"></i> Dinheiro
                </button>
                <button onclick="selectPay('other')" id="pay-other"
                  class="py-3 px-4 rounded-2xl border border-dashed border-gray-300 text-gray-400 font-extrabold text-xs flex items-center justify-center gap-2 hover:bg-gray-50 transition">
                  Outro
                </button>
              </div>

              <div id="pix-box" class="mt-4 bg-paper border border-gray-100 rounded-3xl p-4">
                <div class="flex items-center justify-between">
                  <p class="text-sm font-bold text-gray-800">QR Pix</p>
                  <span class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">placeholder</span>
                </div>
                <div class="mt-3 w-full aspect-square bg-white border border-dashed border-gray-200 rounded-2xl flex items-center justify-center">
                  <div class="text-center px-6">
                    <i data-lucide="qr-code" class="w-8 h-8 text-studio-green mx-auto"></i>
                    <p class="text-xs text-gray-500 mt-2"><b>/assets/pix-qrcode.png</b></p>
                  </div>
                </div>
              </div>

              <button id="btn-confirm-pay" onclick="confirmCheckout()"
                class="mt-4 w-full h-12 rounded-2xl bg-studio-green text-white font-extrabold shadow-lg shadow-green-200 active:scale-95 transition flex items-center justify-center gap-2 text-xs tracking-wide uppercase">
                <i data-lucide="check-circle-2" class="w-5 h-5"></i>
                Confirmar pagamento
              </button>

              <div id="checkout-locked-box" class="hidden mt-4 bg-white border border-dashed border-gray-200 rounded-3xl p-4">
                <p class="text-sm font-bold text-gray-800">Checkout confirmado</p>
                <p class="text-xs text-gray-500 mt-1">Somente leitura. Ajustes via Caixa (futuro).</p>
                <button onclick="toast('Levar para Caixa (demo).')"
                  class="mt-3 w-full h-12 rounded-2xl bg-paper border border-gray-200 text-gray-700 font-extrabold text-xs hover:bg-gray-50 transition">
                  Ver no Caixa
                </button>
              </div>
            </div>

          </div>
        </section>

        <!-- P√ìS -->
        <section class="stage" data-stage="pos">
          <div id="lock-pos" class="hidden bg-white rounded-3xl p-5 shadow-soft border border-white">
            <p class="text-sm font-bold text-gray-800">Etapa bloqueada</p>
            <p class="text-xs text-gray-400 mt-1">Conclua o Checkout para liberar o P√≥s.</p>
          </div>

          <div id="content-pos" class="space-y-5">
            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <h2 class="text-lg font-serif font-bold text-gray-800">P√≥s-atendimento</h2>
                  <p class="text-xs text-gray-400 mt-1">KPI, pesquisa e follow-up.</p>
                </div>
                <span id="badge-pos" class="px-3 py-1 rounded-2xl bg-gray-50 text-gray-500 text-[11px] font-extrabold border border-gray-100">BLOQUEADA</span>
              </div>

              <div class="mt-4 grid grid-cols-2 gap-3">
                <div class="bg-paper rounded-2xl p-3 border border-gray-100">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Tempo total</p>
                  <p id="kpi-total" class="text-sm font-black text-gray-800 tabular-nums">00:00</p>
                </div>
                <div class="bg-paper rounded-2xl p-3 border border-gray-100">
                  <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Status</p>
                  <p class="text-sm font-bold text-gray-800">Finaliz√°vel</p>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <h3 class="text-xs font-extrabold text-gray-400 uppercase tracking-widest mb-4">Pesquisa de satisfa√ß√£o (WhatsApp)</h3>

              <div class="bg-paper border border-gray-100 rounded-3xl p-4">
                <p class="text-sm font-bold text-gray-800">Mensagem padr√£o</p>
                <p class="text-xs text-gray-500 mt-1">
                  ‚ÄúOi Ana! Como foi sua sess√£o hoje? De 0 a 10, qual sua nota? Se quiser, deixe um coment√°rio üòä‚Äù
                </p>

                <div class="mt-3 flex items-center justify-between gap-3">
                  <p id="msg-pos" class="text-[11px] font-bold text-gray-400">Status: n√£o enviada</p>
                  <button onclick="markSent('msg-pos')" class="px-3 py-2 rounded-2xl bg-studio-light text-studio-green font-extrabold text-xs border border-studio-green/10 hover:bg-white transition">
                    Enviar
                  </button>
                </div>
              </div>

              <div class="mt-4 bg-white border border-dashed border-gray-200 rounded-3xl p-4">
                <p class="text-sm font-bold text-gray-800">Resposta</p>
                <p class="text-xs text-gray-400 mt-1">Ainda sem resposta (placeholder).</p>
              </div>
            </div>

            <div class="bg-white rounded-3xl p-5 shadow-soft border border-white">
              <h3 class="text-xs font-extrabold text-gray-400 uppercase tracking-widest mb-4">Follow-up</h3>

              <div class="bg-paper border border-gray-100 rounded-3xl p-4">
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest">Criar tarefa</p>
                <div class="mt-2 flex gap-2">
                  <button onclick="toast('Follow-up em 7 dias (demo).')"
                    class="flex-1 h-11 rounded-2xl bg-white border border-gray-100 text-sm font-extrabold text-studio-green hover:bg-gray-50 transition">
                    +7 dias
                  </button>
                  <button onclick="toast('Follow-up em 30 dias (demo).')"
                    class="flex-1 h-11 rounded-2xl bg-white border border-gray-100 text-sm font-extrabold text-studio-green hover:bg-gray-50 transition">
                    +30 dias
                  </button>
                </div>
              </div>

              <div class="mt-4">
                <p class="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-2">Notas p√≥s-atendimento</p>
                <textarea class="w-full h-28 bg-paper rounded-2xl p-4 text-sm text-gray-700 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-studio-green/20 resize-none"
                  placeholder="Anota√ß√µes finais e pontos para pr√≥ximas sess√µes..."></textarea>
              </div>
            </div>

          </div>
        </section>

      </div>
    </main>

    <!-- Toast -->
    <div id="toast" class="bg-gray-900 text-white rounded-2xl px-4 py-3 text-sm shadow-floaty"></div>

    <!-- Bottom bar -->
    <div id="stage-bar">
      <!-- Status das etapas (pequeno) -->
      <div class="stage-dots mb-2">
        <div id="dot-pre" class="dot"><span class="b"></span>PRE</div>
        <div id="dot-sessao" class="dot"><span class="b"></span>SESS√ÉO</div>
        <div id="dot-checkout" class="dot"><span class="b"></span>CHECKOUT</div>
        <div id="dot-pos" class="dot"><span class="b"></span>P√ìS</div>
      </div>

      <div class="flex items-center gap-3">
        <button onclick="prevStage()"
          class="w-12 h-12 rounded-2xl bg-paper border border-gray-200 text-gray-600 flex items-center justify-center hover:bg-gray-50 transition">
          <i data-lucide="chevron-left" class="w-5 h-5"></i>
        </button>

        <button id="primary-action" onclick="completeStage()"
          class="flex-1 h-12 rounded-2xl bg-studio-green text-white font-extrabold shadow-lg shadow-green-200 active:scale-95 transition flex items-center justify-center gap-2 text-xs tracking-wide uppercase">
          <i data-lucide="check-circle-2" class="w-5 h-5"></i>
          Concluir
        </button>

        <button onclick="nextStage()"
          class="w-12 h-12 rounded-2xl bg-paper border border-gray-200 text-gray-600 flex items-center justify-center hover:bg-gray-50 transition">
          <i data-lucide="chevron-right" class="w-5 h-5"></i>
        </button>
      </div>
    </div>

  </div>

<script>
  lucide.createIcons();

  // -----------------------------
  // Timer (demo)
  // -----------------------------
  let seconds = 0;
  let running = true;
  let timerInterval = null;
  const plannedSeconds = 60 * 60; // 60 min (demo)

  function fmtTime(sec) {
    const m = Math.floor(sec / 60).toString().padStart(2, '0');
    const s = (sec % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }

  function setPlayPauseIcons() {
    const iconPlay = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg>`;
    const iconPause = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" rx="1"></rect><rect x="14" y="4" width="4" height="16" rx="1"></rect></svg>`;

    document.getElementById('header-playpause').innerHTML = running
      ? `${iconPause}<span>Pausar</span>`
      : `${iconPlay}<span>Continuar</span>`;

    document.getElementById('header-playpause-compact').innerHTML = running ? iconPause : iconPlay;
    document.getElementById('bubble-playpause').innerHTML = running ? iconPause : iconPlay;
  }

  function updateTimerUI() {
    const t = fmtTime(seconds);
    document.getElementById('header-time').textContent = t;
    document.getElementById('header-time-compact').textContent = t;
    document.getElementById('bubble-time').textContent = t;
    document.getElementById('kpi-total').textContent = t;

    const pct = Math.min(seconds / plannedSeconds, 1);
    const r = 46;
    const circumference = 2 * Math.PI * r;
    const offset = circumference * (1 - pct);
    const ring = document.getElementById('bubble-ring');
    ring.style.strokeDasharray = `${circumference}`;
    ring.style.strokeDashoffset = `${offset}`;
    ring.classList.toggle('ring-pulse', running && pct < 1);
  }

  function ensureTimer() {
    if (timerInterval) return;
    timerInterval = setInterval(() => {
      if (running) {
        seconds += 1;
        updateTimerUI();
      }
    }, 1000);
  }

  function toggleTimer(e) {
    if (e) e.stopPropagation();
    running = !running;
    setPlayPauseIcons();
    updateTimerUI();
    toast(running ? 'Cron√¥metro em execu√ß√£o.' : 'Cron√¥metro pausado.');
  }

  setPlayPauseIcons();
  updateTimerUI();
  ensureTimer();

  // -----------------------------
  // Header collapse on scroll (sem ‚Äúsumir‚Äù)
  // -----------------------------
  const scrollEl = document.getElementById('scroll');
  const headerEl = document.getElementById('header');

  scrollEl.addEventListener('scroll', () => {
    const compact = scrollEl.scrollTop > 12;
    headerEl.classList.toggle('compact', compact);
  });

  // -----------------------------
  // Stages (horizontal)
  // -----------------------------
  const stages = ['pre','sessao','checkout','pos'];
  const pager = document.getElementById('pager');

  const state = {
    current: 'pre',
    status: { pre:'pending', sessao:'locked', checkout:'locked', pos:'locked' },
    checkoutLocked: false,
    discountMode: 'value',
    payMethod: 'pix',
    subtotal: 170.00,
    discountValue: 0.00,
  };

  function stageIndex(id){ return stages.indexOf(id); }

  function setStageBadges() {
    // badges no topo de cada se√ß√£o
    document.getElementById('badge-pre').textContent = state.status.pre === 'done' ? 'OK' : 'PENDENTE';

    document.getElementById('badge-sessao').textContent =
      state.status.sessao === 'locked' ? 'BLOQUEADA' : (state.status.sessao === 'done' ? 'OK' : 'LIBERADA');

    document.getElementById('badge-checkout').textContent =
      state.status.checkout === 'locked' ? 'BLOQUEADA' : (state.status.checkout === 'done' ? 'OK' : 'LIBERADA');

    document.getElementById('badge-pos').textContent =
      state.status.pos === 'locked' ? 'BLOQUEADA' : (state.status.pos === 'done' ? 'OK' : 'LIBERADA');

    // overlays
    const sessaoLocked = state.status.sessao === 'locked';
    document.getElementById('lock-sessao').classList.toggle('hidden', !sessaoLocked);
    document.getElementById('content-sessao').classList.toggle('hidden', sessaoLocked);

    const checkoutLocked = state.status.checkout === 'locked';
    document.getElementById('lock-checkout').classList.toggle('hidden', !checkoutLocked);
    document.getElementById('content-checkout').classList.toggle('hidden', checkoutLocked);

    const posLocked = state.status.pos === 'locked';
    document.getElementById('lock-pos').classList.toggle('hidden', !posLocked);
    document.getElementById('content-pos').classList.toggle('hidden', posLocked);
  }

  // Status dots: cinza = n√£o iniciado | studio = em execu√ß√£o | verde = conclu√≠do
  function setStageDots() {
    stages.forEach(s => {
      const dot = document.getElementById('dot-' + s);
      dot.classList.remove('running','done');

      if (state.status[s] === 'done') dot.classList.add('done');
      if (state.current === s) dot.classList.add('running'); // em execu√ß√£o sempre vence visualmente
    });
  }

  function goStage(id){
    const idx = stageIndex(id);
    const width = pager.clientWidth;
    pager.scrollTo({ left: idx * width, behavior: 'smooth' });
    state.current = id;
    setStageDots();
    setStageBadges();

    if (state.status[id] === 'locked') toast('Esta etapa est√° bloqueada.');
  }

  function prevStage(){
    const idx = Math.max(0, stageIndex(state.current) - 1);
    goStage(stages[idx]);
  }

  function nextStage(){
    const idx = Math.min(stages.length - 1, stageIndex(state.current) + 1);
    goStage(stages[idx]);
  }

  // Detectar etapa no swipe horizontal
  let scrollTimer = null;
  pager.addEventListener('scroll', () => {
    clearTimeout(scrollTimer);
    scrollTimer = setTimeout(() => {
      const width = pager.clientWidth;
      const idx = Math.round(pager.scrollLeft / width);
      state.current = stages[idx];
      setStageDots();
      setStageBadges();
    }, 80);
  });

  function completeStage(){
    const cur = state.current;
    if (state.status[cur] === 'locked') { toast('Etapa bloqueada.'); return; }

    // regra: checkout s√≥ conclui se pagamento estiver confirmado
    if (cur === 'checkout' && !state.checkoutLocked) {
      toast('Confirme o pagamento antes de concluir o Checkout.');
      return;
    }

    state.status[cur] = 'done';

    if (cur === 'pre') state.status.sessao = 'available';
    if (cur === 'sessao') state.status.checkout = 'available';
    if (cur === 'checkout') state.status.pos = 'available';

    setStageBadges();
    setStageDots();

    if (cur === 'pos') toast('Fluxo finalizado (demo).');
    else { toast('Etapa conclu√≠da.'); nextStage(); }
  }

  function confirmAppointment() {
    document.getElementById('confirm-status').textContent = 'Confirmada manualmente (demo)';
    document.getElementById('confirm-status').className = 'text-[11px] font-bold text-ok';
    if (state.status.sessao === 'locked') state.status.sessao = 'available';
    toast('Confirma√ß√£o registrada.');
    setStageBadges();
    setStageDots();
  }

  // -----------------------------
  // Checkout: desconto e pagamento
  // -----------------------------
  function moneyBR(v) {
    return v.toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
  }

  function setDiscountMode(mode) {
    state.discountMode = mode;
    const btnV = document.getElementById('mode-value');
    const btnP = document.getElementById('mode-pct');

    if (mode === 'value') {
      btnV.className = "px-3 py-1.5 rounded-2xl bg-studio-light text-studio-green font-extrabold text-[11px] border border-studio-green/10";
      btnP.className = "px-3 py-1.5 rounded-2xl bg-paper text-gray-500 font-extrabold text-[11px] border border-gray-200";
    } else {
      btnP.className = "px-3 py-1.5 rounded-2xl bg-studio-light text-studio-green font-extrabold text-[11px] border border-studio-green/10";
      btnV.className = "px-3 py-1.5 rounded-2xl bg-paper text-gray-500 font-extrabold text-[11px] border border-gray-200";
    }
    recalcTotal();
  }

  function recalcTotal() {
    const raw = parseFloat(document.getElementById('discount-input').value || '0');
    const subtotal = state.subtotal;

    let disc = 0;
    if (state.discountMode === 'value') {
      disc = Math.max(0, Math.min(raw, subtotal));
    } else {
      const pct = Math.max(0, Math.min(raw, 100));
      disc = subtotal * (pct / 100);
    }

    state.discountValue = disc;
    document.getElementById('discount-applied').textContent = moneyBR(disc);

    const total = Math.max(0, subtotal - disc);
    document.getElementById('total').textContent = moneyBR(total);
  }

  function selectPay(method) {
    state.payMethod = method;
    const ids = ['pix','card','cash','other'];
    ids.forEach(m => {
      const el = document.getElementById(`pay-${m}`);
      const active = (m === method);
      el.className = active
        ? "py-3 px-4 rounded-2xl border-2 border-studio-green bg-studio-light text-studio-green font-extrabold text-xs flex items-center justify-center gap-2"
        : "py-3 px-4 rounded-2xl border border-gray-200 text-gray-500 font-extrabold text-xs flex items-center justify-center gap-2 hover:bg-gray-50 transition";
    });

    // mostrar QR s√≥ em pix e se n√£o travou checkout
    const showPix = method === 'pix' && !state.checkoutLocked;
    document.getElementById('pix-box').classList.toggle('hidden', !showPix);
  }

  function confirmCheckout(){
    if (state.status.checkout === 'locked') { toast('Checkout bloqueado.'); return; }
    state.checkoutLocked = true;

    document.getElementById('pay-status').textContent = 'CONFIRMADO';
    document.getElementById('pay-status').className = "px-3 py-1 rounded-2xl bg-green-50 text-ok text-[11px] font-extrabold border border-green-100";

    document.getElementById('discount-input').disabled = true;
    document.getElementById('discount-reason').disabled = true;
    document.getElementById('btn-confirm-pay').classList.add('hidden');

    document.getElementById('pix-box').classList.add('hidden');
    document.getElementById('checkout-locked-box').classList.remove('hidden');

    toast('Pagamento confirmado. Checkout travado.');
    setStageBadges();
    setStageDots();
  }

  recalcTotal();
  selectPay('pix');

  // -----------------------------
  // Minimizar para bolha
  // -----------------------------
  function minimizeToBubble() {
    document.getElementById('timer-bubble').style.display = 'block';
    toast('Bolha ativa (demo).');
  }
  function restoreFromBubble() {
    document.getElementById('timer-bubble').style.display = 'none';
    toast('Voltando para o atendimento.');
  }

  // -----------------------------
  // Drag bubble
  // -----------------------------
  let active = false;
  let currentX = 0, currentY = 0, initialX = 0, initialY = 0, xOffset = 0, yOffset = 0;
  const dragItem = document.getElementById("timer-bubble");

  function dragStart(e) {
    if (e.type === "touchstart") {
      initialX = e.touches[0].clientX - xOffset;
      initialY = e.touches[0].clientY - yOffset;
    } else {
      initialX = e.clientX - xOffset;
      initialY = e.clientY - yOffset;
    }
    active = true;
  }
  function dragEnd() { active = false; }
  function drag(e) {
    if (!active) return;
    e.preventDefault();

    if (e.type === "touchmove") {
      currentX = e.touches[0].clientX - initialX;
      currentY = e.touches[0].clientY - initialY;
    } else {
      currentX = e.clientX - initialX;
      currentY = e.clientY - initialY;
    }
    xOffset = currentX; yOffset = currentY;
    dragItem.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
  }
  document.addEventListener("mouseup", dragEnd);
  document.addEventListener("touchend", dragEnd);
  document.addEventListener("mousemove", drag);
  document.addEventListener("touchmove", drag);

  // -----------------------------
  // Mensageria demo + Toast
  // -----------------------------
  function markSent(id) {
    const el = document.getElementById(id);
    el.textContent = "Status: enviada (manual - demo)";
    el.className = "text-[11px] font-bold text-ok";
    toast('Mensagem marcada como enviada.');
  }

  let toastTimer = null;
  function toast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.style.display = 'block';
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.style.display = 'none', 2200);
  }

  // init
  setStageBadges();
  setStageDots();
</script>

</body>
</html>
